var renderer,scene,camera;alert("avoid comets, collect diamonds, A - left D - right");var ship,target,heart1,heart2,heart3,comet,gameOver,scoreText,intervalCounter,redColisionLight,globalLight,shipLight,box,model,keyboard=new THREEx.KeyboardState,positionLimit=13,shipSpeed=.2,bullets=[],cometSpeed=.01,collidableMeshList=[],heartMeshList=[],heartInterface=[3],numberOfHearts=3,gameOverTrue=0,score=-2,countAlive=0,immortality=0,diamondsList=[],diamondTaken=0,isLoaded=0,audio=new Audio("diam.mp3"),audio2=new Audio("crash.mp3"),superPoints=[],darkModeStatus=0;function init(){scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.1,2e3),(renderer=new THREE.WebGLRenderer({antialias:!0})).setSize(window.innerWidth,window.innerHeight),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,document.body.appendChild(renderer.domElement),camera.position.z=10,camera.position.y=6;var e=new THREE.BoxGeometry(3.4,.5,1),t=new THREE.MeshBasicMaterial({color:4473924,colorWrite:0});(box=new THREE.Mesh(e,t)).position.z-=2,box.position.y-=.5,box.receiveShadow=!0,scene.add(box),(new THREE.GLTFLoader).load("SpaceShip.glb",function(e){(ship=e.scene.children[0]).scale.set(.5,.5,.5),scene.add(ship),ship.position.set(0,0,-2),setTimeout(isLoadedOn,1e3)}),darkMode(),standardMode();var o=-50,i=new THREE.Shape;i.moveTo(25,25),i.bezierCurveTo(25,-25,20,o,0,o),i.bezierCurveTo(-30,o,-30,-15,-30,-15),i.bezierCurveTo(-30,5,-10,27,25,45),i.bezierCurveTo(60,27,80,5,80,-15),i.bezierCurveTo(80,-15,80,o,50,o),i.bezierCurveTo(35,o,25,-25,25,-25);e=new THREE.ExtrudeGeometry(i,{depth:10,bevelEnabled:!0,bevelSegments:2,steps:2,bevelSize:15,bevelThickness:15});(heart1=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:16711680}))).receiveShadow=!0,heart1.rotation.z=Math.PI/.85,heart1.scale.set(.005,.005,.005),heart1.position.set(-10.5,12.6,-1),scene.add(heart1),(heart2=heart1.clone()).position.x+=1,scene.add(heart2),(heart3=heart1.clone()).position.x+=2,scene.add(heart3),livesText(),intervalCounter=setInterval(counterStart,500),bcgCreate(),setInterval(generateComets,120),setInterval(generateHearts,1e4),setInterval(generateDiamonds,1900)}function animate(){requestAnimationFrame(animate),1==isLoaded&&(1==darkModeStatus&&(shipLight.position.set(ship.position.x,ship.position.y,ship.position.z),shipLight.target.position.set(ship.position.x,ship.position.y,-10)),bcgMovement(),cometsMovement(),heartsMovement(),diamondsMovement(),colisionDetector(),heartColisionDetector(),diamondsColisionDetector(),keyboardControl()),renderer.render(scene,camera)}function standardMode(){(globalLight=new THREE.PointLight(16777215,.95,180)).position.set(0,5,10),globalLight.castShadow=!0,globalLight.shadow.camera.near=.01,globalLight.shadow.camera.far=500,scene.add(globalLight),(redColisionLight=new THREE.PointLight(16711680,1.5,180)).position.set(0,5,10),redColisionLight.castShadow=!0,redColisionLight.shadow.camera.near=.01,redColisionLight.shadow.camera.far=10}function darkMode(){darkModeStatus=1,(globalLight=new THREE.PointLight(16777215,.8,30)).position.set(0,5,10),globalLight.castShadow=!0,globalLight.shadow.camera.near=.01,globalLight.shadow.camera.far=500,scene.add(globalLight);var e=Math.PI/8;(shipLight=new THREE.SpotLight(16777215,.4,150,e,.5)).position.set(0,0,-3),shipLight.target.position.set(0,0,-10),scene.add(shipLight),scene.add(shipLight.target)}function counterStart(){var e;0!=countAlive&&scene.remove(count),delete count,e=-2==score?"READY":-1==score?"STEADY":0==score?"GO!":score,(new THREE.FontLoader).load("Consolas.json",function(t){var o=new THREE.TextGeometry(String(e),{font:t,size:1,height:.1});o.center();var i=new THREE.MeshBasicMaterial({color:65280});count=new THREE.Mesh(o,i),scene.add(count),count.position.z=-5,count.position.y=15,countAlive=1}),score++}function bcgCreate(){starGeo=new THREE.Geometry;for(let t=0;t<1e3;t++){var e=new THREE.Vector3(900*Math.random()-450,900*Math.random()-450,2e3*Math.random()-1e3);e.velocity=0,e.acceleration=cometSpeed,starGeo.vertices.push(e)}let t=(new THREE.TextureLoader).load("star.png"),o=new THREE.PointsMaterial({color:16777215,size:1,map:t});stars=new THREE.Points(starGeo,o),scene.add(stars)}function bcgMovement(){starGeo.vertices.forEach(e=>{e.velocity+=e.acceleration,e.z+=e.velocity,e.z>0&&(e.z=-200,e.velocity=0)}),starGeo.verticesNeedUpdate=!0}function generateHearts(){var e=-50,t=new THREE.Shape;t.moveTo(25,25),t.bezierCurveTo(25,-25,20,e,0,e),t.bezierCurveTo(-30,e,-30,-15,-30,-15),t.bezierCurveTo(-30,5,-10,27,25,45),t.bezierCurveTo(60,27,80,5,80,-15),t.bezierCurveTo(80,-15,80,e,50,e),t.bezierCurveTo(35,e,25,-25,25,-25);var o=new THREE.ExtrudeGeometry(t,{depth:10,bevelEnabled:!0,bevelSegments:2,steps:2,bevelSize:15,bevelThickness:15}),i=new THREE.Mesh(o,new THREE.MeshStandardMaterial({color:16711680}));i.receiveShadow=!0,i.rotation.z=Math.PI,i.scale.set(.05,.05,.05),i.position.set(4*Math.random()+1,4*Math.random()+1,1),i.position.y+=15,i.position.set(40*Math.random()-20,0,-300),i.velocity=new THREE.Vector3(.2*Math.random()-.1,0,.6),i.alive=!0,setTimeout(function(){i.alive=!1,i.remove(i)},6e3),heartMeshList.push(i),scene.add(i)}function heartsMovement(){for(var e=0;e<heartMeshList.length;e++)void 0!==heartMeshList[e]&&(0!=heartMeshList[e].alive?heartMeshList[e].position.add(heartMeshList[e].velocity):heartMeshList.splice(e,1))}function generateComets(){var e=new THREE.Mesh(new THREE.BoxGeometry(4*Math.random()+1,4*Math.random()+1,1),new THREE.MeshStandardMaterial({color:1193046}));e.receiveShadow=!0,e.position.set(40*Math.random()-20,0,-300),e.velocity=new THREE.Vector3(.2*Math.random()-.1,0,.6),e.alive=!0,setTimeout(function(){e.alive=!1,scene.remove(e)},6e3),collidableMeshList.push(e),scene.add(e)}function cometsMovement(){for(var e=0;e<collidableMeshList.length;e++)void 0!==collidableMeshList[e]&&(0!=collidableMeshList[e].alive?collidableMeshList[e].position.add(collidableMeshList[e].velocity):collidableMeshList.splice(e,1))}function generateDiamonds(){var e=new THREE.Mesh(new THREE.OctahedronBufferGeometry(1.5),new THREE.MeshStandardMaterial({color:65280,metalness:1,roughness:.7}));e.receiveShadow=!0,e.position.set(40*Math.random()-20,0,-300),e.velocity=new THREE.Vector3(.2*Math.random()-.1,0,.6),e.alive=!0,setTimeout(function(){e.alive=!1,e.remove(comet)},6e3),diamondsList.push(e),scene.add(e)}function diamondsMovement(){for(var e=0;e<diamondsList.length;e++)void 0!==diamondsList[e]&&(0!=diamondsList[e].alive?diamondsList[e].position.add(diamondsList[e].velocity):diamondsList.splice(e,1))}function keyboardControl(){var e=ship.position.x;e<positionLimit&&keyboard.pressed("D")?(ship.position.x+=shipSpeed,box.position.x+=shipSpeed):(ship.rotation.z=0,box.rotation.z=0),e>-positionLimit?keyboard.pressed("A")&&(ship.position.x-=shipSpeed,box.position.x-=shipSpeed):ship.rotation.z=0,keyboard.pressed("A")&&(ship.rotation.z=Math.PI/8,box.rotation.z=Math.PI/8),keyboard.pressed("D")&&(ship.rotation.z=-Math.PI/8,box.rotation.z=-Math.PI/8),document.onkeydown=function(e){switch((e=e||window.event).keyCode){case 13:1==gameOverTrue&&restart(),brake}}}function colisionDetector(){for(var e=0;e<collidableMeshList.length;e++)for(var t=box.position.clone(),o=0;o<box.geometry.vertices.length;o++){var i=box.geometry.vertices[o].clone().applyMatrix4(box.matrix).sub(box.position),n=new THREE.Raycaster(t,i.clone().normalize()).intersectObjects(collidableMeshList);if(n.length>0&&n[0].distance<i.length()){if(audio2.play(),console.log(numberOfHearts),3==numberOfHearts&&0==immortality)return numberOfHearts=2,scene.remove(collidableMeshList[e]),collidableMeshList.splice(e,1),scene.remove(heart3),immortality=1,setTimeout(immortalityOff,100),void redLightOn();if(2==numberOfHearts&&0==immortality)return numberOfHearts=1,scene.remove(collidableMeshList[e]),collidableMeshList.splice(e,1),scene.remove(heart2),immortality=1,setTimeout(immortalityOff,100),void redLightOn();if(1==numberOfHearts&&0==immortality)return numberOfHearts=0,scene.remove(collidableMeshList[e]),collidableMeshList.splice(e,1),scene.remove(heart1),scene.remove(collidableMeshList[e]),collidableMeshList.splice(e,1),scene.remove(ship),0==gameOverTrue&&(gameOverFont(),gameOverTrue++),void clearInterval(intervalCounter)}}}function heartColisionDetector(){for(var e=0;e<heartMeshList.length;e++)for(var t=box.position.clone(),o=0;o<box.geometry.vertices.length;o++){var i=box.geometry.vertices[o].clone().applyMatrix4(box.matrix).sub(box.position),n=new THREE.Raycaster(t,i.clone().normalize()).intersectObjects(heartMeshList);if(n.length>0&&n[0].distance<i.length())return audio.play(),scene.remove(heartMeshList[e]),heartMeshList.splice(e,1),3==numberOfHearts?0:2==numberOfHearts?(numberOfHearts=3,scene.add(heart3),0):1==numberOfHearts?(numberOfHearts=2,scene.add(heart2),0):0}}function diamondsColisionDetector(){for(var e=0;e<diamondsList.length;e++)for(var t=box.position.clone(),o=0;o<box.geometry.vertices.length;o++){var i=box.geometry.vertices[o].clone().applyMatrix4(box.matrix).sub(ship.position),n=new THREE.Raycaster(t,i.clone().normalize()).intersectObjects(diamondsList);if(n.length>0&&n[0].distance<i.length()&&0==diamondTaken)return scene.remove(diamondsList[e]),diamondsList.splice(e,1),score+=50,diamondTaken=1,audio.play(),setTimeout(diamondTakenOff,100),0}}function gameOverFont(){(new THREE.FontLoader).load("Consolas.json",function(e){var t=new THREE.TextGeometry("GAME OVER",{font:e,size:2.6,height:.01});t.center();var o=new THREE.MeshBasicMaterial({color:16711680});gameOver=new THREE.Mesh(t,o),scene.add(gameOver),gameOver.position.z=-5,gameOver.position.y=6;var i=new THREE.TextGeometry("Your score:"+(score-1),{font:e,size:1,height:.01});i.center(),scoreText=new THREE.Mesh(i,o),scene.add(scoreText),scoreText.position.z=-5,scoreText.position.y=4;var n=new THREE.TextGeometry("Press ENTER to play again",{font:e,size:1,height:.01});n.center(),againText=new THREE.Mesh(n,o),scene.add(againText),againText.position.z=-5,againText.position.y=2.4})}function livesText(){(new THREE.FontLoader).load("Consolas.json",function(e){var t=new THREE.TextGeometry(String("LIVES: "),{font:e,size:1,height:.1,curveSegments:2});t.center();var o=new THREE.MeshBasicMaterial({color:16711680}),i=new THREE.Mesh(t,o);scene.add(i),i.position.z=-5,i.position.y=15,i.position.x=-18})}function restart(){for(var e=0;e<collidableMeshList.length;e++)scene.remove(collidableMeshList[e]);for(e=0;e<heartMeshList.length;e++)scene.remove(heartMeshList[e]);for(e=0;e<diamondsList.length;e++)scene.remove(diamondsList[e]);numberOfHearts=3,gameOverTrue=0,diamondTaken=0,scene.add(heart1,heart2,heart3),ship.position.x=0,box.position.x=0,scene.add(ship),score=-2,scene.remove(gameOver),scene.remove(scoreText),scene.remove(againText),clearInterval(intervalCounter),intervalCounter=setInterval(counterStart,500)}function immortalityOn(){immortality=1}function immortalityOff(){immortality=0}function diamondTakenOff(){diamondTaken=0}function isLoadedOn(){isLoaded=1}function redLightOn(){scene.add(redColisionLight),setTimeout(redLightOff,300)}function redLightOff(){scene.remove(redColisionLight)}init(),animate(),window.addEventListener("resize",function(){var e=window.innerWidth,t=window.innerHeight;renderer.setSize(e,t),camera.aspect=e/t,camera.updateProjectionMatrix()}),animate();